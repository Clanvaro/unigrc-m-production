# =============================================================================
# UniGRC - Google Cloud Platform Environment Variables
# =============================================================================
# This file contains environment variables specifically for GCP deployment
# using Cloud Run, Cloud SQL, and Cloud Storage.
#
# SETUP INSTRUCTIONS:
# 1. Copy this file to create your actual environment configuration
# 2. Fill in all <PLACEHOLDER> values with your actual GCP resources
# 3. Set these variables in Cloud Run via gcloud or GCP Console
# 4. NEVER commit actual secrets to version control
# =============================================================================

# -----------------------------------------------------------------------------
# NODE ENVIRONMENT
# -----------------------------------------------------------------------------
NODE_ENV=production
# Must be 'production' for Cloud Run deployment

PORT=8080
# Cloud Run requires port 8080 (do not change)

# -----------------------------------------------------------------------------
# DATABASE - Cloud SQL (PostgreSQL)
# -----------------------------------------------------------------------------
# Connection string format for Cloud SQL with public IP:
# postgresql://USER:PASSWORD@PUBLIC_IP:5432/DATABASE?sslmode=require
#
# Example:
# DATABASE_URL=postgresql://unigrc_user:SecurePassword123@34.123.45.67:5432/unigrc_db?sslmode=require

DATABASE_URL=postgresql://<DB_USER>:<DB_PASSWORD>@<CLOUD_SQL_PUBLIC_IP>:5432/<DB_NAME>?sslmode=require

# Alternative: Cloud SQL Unix Socket (if using private IP with Cloud SQL Proxy)
# DATABASE_URL=postgresql://USER:PASSWORD@localhost/DATABASE?host=/cloudsql/PROJECT:REGION:INSTANCE

# -----------------------------------------------------------------------------
# SECURITY - SESSION & CSRF (REQUIRED)
# -----------------------------------------------------------------------------
# Generate secure random strings with:
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

SESSION_SECRET=<GENERATE_SECURE_RANDOM_STRING_32_CHARS>
# CRITICAL: Must be different in each environment

CSRF_SECRET=<GENERATE_SECURE_RANDOM_STRING_32_CHARS>
# CRITICAL: Must be different in each environment

# Trust Proxy Configuration (for Cloud Run behind Google Load Balancer)
TRUST_PROXY_COUNT=1
# Cloud Run with Google Load Balancer: 1

# -----------------------------------------------------------------------------
# CLOUD STORAGE - Google Cloud Storage (File Uploads)
# -----------------------------------------------------------------------------
# Option 1: Service Account Key File (NOT RECOMMENDED for Cloud Run)
# GCS_KEY_FILE=/path/to/service-account-key.json

# Option 2: Service Account Credentials as Environment Variables (RECOMMENDED)
GCS_PROJECT_ID=<GCP_PROJECT_ID>
# Your Google Cloud project ID

GCS_BUCKET_NAME=<BUCKET_NAME>
# Your GCS bucket name for file uploads (e.g., unigrc-uploads)

GCS_CLIENT_EMAIL=<SERVICE_ACCOUNT_EMAIL>
# Service account email (e.g., unigrc-storage@project-id.iam.gserviceaccount.com)

GCS_PRIVATE_KEY="<SERVICE_ACCOUNT_PRIVATE_KEY>"
# Service account private key (entire key including -----BEGIN PRIVATE KEY-----)
# IMPORTANT: Must be enclosed in double quotes and include newlines as \n
# Example: "-----BEGIN PRIVATE KEY-----\nMIIEvgIBA...\n-----END PRIVATE KEY-----\n"

# Alternative: Use Workload Identity (BEST for Cloud Run)
# If using Workload Identity, you don't need GCS_CLIENT_EMAIL or GCS_PRIVATE_KEY
# Just set GCS_PROJECT_ID and GCS_BUCKET_NAME
# See: https://cloud.google.com/run/docs/configuring/workload-identity

# -----------------------------------------------------------------------------
# CORS - ALLOWED ORIGINS
# -----------------------------------------------------------------------------
# Set to your frontend Cloud Run URL
FRONTEND_URL=https://<FRONTEND_SERVICE_URL>.run.app
# Example: https://unigrc-frontend-abc123.run.app

# For multiple origins (comma-separated):
# ALLOWED_ORIGINS=https://frontend.run.app,https://custom-domain.com

# -----------------------------------------------------------------------------
# REDIS - Upstash Redis (Distributed Cache)
# -----------------------------------------------------------------------------
# Keep your existing Upstash Redis configuration (no changes needed)
UPSTASH_REDIS_REST_URL=<YOUR_UPSTASH_REDIS_REST_URL>
UPSTASH_REDIS_REST_TOKEN=<YOUR_UPSTASH_REDIS_REST_TOKEN>

# -----------------------------------------------------------------------------
# EMAIL - SendGrid or Mailgun (Optional)
# -----------------------------------------------------------------------------
# SendGrid Configuration
SENDGRID_API_KEY=<YOUR_SENDGRID_API_KEY>
SENDGRID_FROM_EMAIL=noreply@yourdomain.com
SENDGRID_FROM_NAME=UniGRC

# OR Mailgun Configuration
MAILGUN_API_KEY=<YOUR_MAILGUN_API_KEY>
MAILGUN_DOMAIN=mg.yourdomain.com
MAILGUN_FROM_EMAIL=noreply@yourdomain.com

# -----------------------------------------------------------------------------
# SMS - Twilio (Optional)
# -----------------------------------------------------------------------------
TWILIO_ACCOUNT_SID=<YOUR_TWILIO_ACCOUNT_SID>
TWILIO_AUTH_TOKEN=<YOUR_TWILIO_AUTH_TOKEN>
TWILIO_PHONE_NUMBER=+1234567890

# -----------------------------------------------------------------------------
# AI SERVICES - Azure OpenAI (Optional)
# -----------------------------------------------------------------------------
AZURE_OPENAI_ENDPOINT=https://<YOUR_RESOURCE>.openai.azure.com/
AZURE_OPENAI_API_KEY=<YOUR_AZURE_OPENAI_API_KEY>
AZURE_OPENAI_DEPLOYMENT=gpt-4o-mini

# -----------------------------------------------------------------------------
# LOGGING & MONITORING (Optional)
# -----------------------------------------------------------------------------
LOG_LEVEL=info
# Options: error | warn | info | debug

SENTRY_DSN=<YOUR_SENTRY_DSN>
# Sentry error tracking DSN (optional)

# -----------------------------------------------------------------------------
# GCP-SPECIFIC FLAGS
# -----------------------------------------------------------------------------
IS_GCP_DEPLOYMENT=true
# Set to 'true' when deploying to GCP

# -----------------------------------------------------------------------------
# HEALTH CHECKS
# -----------------------------------------------------------------------------
HEALTH_CHECK_PATH=/health
# Path for health check endpoint (Cloud Run uses this)

# =============================================================================
# HOW TO SET ENVIRONMENT VARIABLES IN CLOUD RUN
# =============================================================================
#
# Method 1: Via gcloud CLI (recommended for automation)
# ------------------------------------------------------
# gcloud run services update backend-service \
#   --region=<REGION> \
#   --set-env-vars="NODE_ENV=production,PORT=8080" \
#   --set-env-vars="DATABASE_URL=postgresql://..." \
#   --set-env-vars="SESSION_SECRET=..." \
#   --set-env-vars="CSRF_SECRET=..."
#
# Method 2: Via GCP Console (recommended for manual setup)
# ---------------------------------------------------------
# 1. Go to Cloud Run > Select your service
# 2. Click "Edit & Deploy New Revision"
# 3. Go to "Variables & Secrets" tab
# 4. Add each environment variable
# 5. Click "Deploy"
#
# Method 3: Using Secret Manager (BEST for sensitive data)
# ---------------------------------------------------------
# 1. Store secrets in Secret Manager:
#    gcloud secrets create session-secret --data-file=- <<< "your-secret-here"
#
# 2. Grant Cloud Run service account access:
#    gcloud secrets add-iam-policy-binding session-secret \
#      --member="serviceAccount:PROJECT_NUMBER-compute@developer.gserviceaccount.com" \
#      --role="roles/secretmanager.secretAccessor"
#
# 3. Reference in Cloud Run:
#    gcloud run services update backend-service \
#      --update-secrets=SESSION_SECRET=session-secret:latest
#
# =============================================================================
# SECURITY BEST PRACTICES
# =============================================================================
# 1. Use Secret Manager for sensitive values (SESSION_SECRET, DB_PASSWORD, API keys)
# 2. Rotate secrets regularly (at least every 90 days)
# 3. Use different secrets for each environment (dev, staging, production)
# 4. Enable Cloud SQL SSL enforcement
# 5. Use Workload Identity instead of service account keys when possible
# 6. Restrict Cloud Storage bucket permissions (private by default)
# 7. Enable Cloud Run authentication for internal services
# 8. Use VPC connector for private Cloud SQL access (optional, more secure)
# =============================================================================
